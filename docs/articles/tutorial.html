<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>patRoon tutorial â€¢ patRoon</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="patRoon tutorial">
<meta property="og:description" content="patRoon">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">patRoon</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Reference
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../reference/index.html">Online</a>
    </li>
    <li>
      <a href="../reference/patRoon.pdf">PDF</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorial
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/tutorial.html">Online HTML page</a>
    </li>
    <li>
      <a href="../articles/tutorial.pdf">PDF</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Handbook
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../handbook_bd/index.html">Book format</a>
    </li>
    <li>
      <a href="../articles/handbook.html">Single page</a>
    </li>
    <li>
      <a href="../handbook_bd/handbook.pdf">PDF</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/rickhelmus/patRoon">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="tutorial_files/htmlwidgets-1.5.1/htmlwidgets.js"></script><script src="tutorial_files/viz-1.8.2/viz.js"></script><link href="tutorial_files/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="tutorial_files/grViz-binding-1.0.6.1/grViz.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>patRoon tutorial</h1>
                        <h4 class="author">Rick Helmus</h4>
            
            <h4 class="date">2020-08-19</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/rickhelmus/patRoon/blob/master/vignettes/tutorial.Rmd"><code>vignettes/tutorial.Rmd</code></a></small>
      <div class="hidden name"><code>tutorial.Rmd</code></div>

    </div>

    
    
<style type="text/css">
pre, code {
    white-space: pre !important;
    overflow-x: auto !important;
    max-height: 275px;
    overflow-y: auto;
}

blockquote {
    background-color: aliceblue;
    padding: 0.25em 0.75em;
}

p.caption {
  font-size: 0.8em;
}
</style>
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<!-- UNDONE: link to advanced vignette -->
<p>In this tutorial you will learn how to perform a simple non-target analysis with <code>patRoon</code>. This tutorial is not meant to give a detailed overview of <code>patRoon</code>. Instead, it serves as a quick introduction on how to use <code>patRoon</code> to setup and perform a full non-target analysis workflow.</p>
<p>The workflow in this tutorial consists of the following steps:</p>
<div id="htmlwidget-8bf07dd8957a39a1def5" style="width:750px;height:100px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-8bf07dd8957a39a1def5">{"x":{"diagram":"\ndigraph rmarkdown {\ngraph [ rankdir = LR ]\nnode [ shape = box,\n       fixedsize = true,\n       width = 2.2,\n       height = 1,\n       fontsize = 18,\n       fillcolor = darkseagreen1,\n       style = filled ]\n\"New project\" -> Features -> Annotation -> Reporting [ arrowhead = vee ]\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="data" class="section level1">
<h1 class="hasAnchor">
<a href="#data" class="anchor"></a>Data</h1>
<p>In this tutorial we will use example data provided within the <a href="https://github.com/rickhelmus/patRoonData">patRoonData</a> package. Please make sure this package is installed (see the <a href="https://rickhelmus.github.io/patRoon/">readme</a> for brief installation instructions). The example dataset contains LC-MS data for a standard mixture with known composition ('standard-X') and a blank solvent ('solvent-X'), both in triplicate. While this may not seem like the most exciting data, it does allow to demonstrate the most important functionalities of <code>patRoon</code>.</p>
<!-- UNDONE: Move/Refer below to other vignette -->
<p>The provided analyses already have been exported to an open format (<em>.mzML</em>) and are ready to use. For your own data it may be necessary to first export your data to <em>mzXML</em> or <em>mzML</em> and perform other data pre-treatment steps such as mass re-calibration. This can be done using the tools from <a href="http://proteowizard.sourceforge.net/">ProteoWizard</a> or software from your mass spectrometer vendor. Alternatively, <code>patRoon</code> can do this automatically for your analyses with the <code><a href="../reference/convertMSFiles.html">convertMSFiles()</a></code> function. Please see the reference manual or other vignettes for its usage.</p>
</div>
<div id="new-project" class="section level1">
<h1 class="hasAnchor">
<a href="#new-project" class="anchor"></a>New project</h1>
<p>Whenever you start a new non-target analysis it is highly recommended to start this from a fresh <em>project directory</em>. This directory will contain your <code>R</code> processing script(s) and any other output generated during the workflow. Note that this directory does not have to contain the raw MS data files. In fact, keeping these files separate may be handy, for instance, if you want to run multiple non-target analyses on these files or store the analysis files on a shared location.</p>
<p>Starting a new project typically consists of</p>
<ol style="list-style-type: decimal">
<li>Creating a new directory (unsurprisingly!)</li>
<li>Changing the active working directory to the project directory (e.g. with <code><a href="https://rdrr.io/r/base/getwd.html">setwd()</a></code>).</li>
<li>Create (or copy) an <code>R</code> processing script.</li>
</ol>
<p>Note that step 2 is important as any output files (e.g. reports and cached results) are stored to the current working directory by default. Consequently, always take care to ensure that this directory is active, for instance, after restarting <code>R</code>.</p>
<p>Steps 1-3 can be easily performed with the <code><a href="../reference/GUI-utils.html">newProject()</a></code> function. Alternatively, you can of course also perform these steps yourself. Both approaches will be discussed in the next sections.</p>
<div id="automatic-project-creation" class="section level2">
<h2 class="hasAnchor">
<a href="#automatic-project-creation" class="anchor"></a>Automatic project creation</h2>
<p>Ensure that RStudio is active and start the new project utility:</p>
<div class="sourceCode"><html><body><pre class="r"><span class="kw pkg">patRoon</span><span class="kw ns">::</span><span class="fu"><a href="../reference/GUI-utils.html">newProject</a></span>()</pre></body></html></div>
<blockquote>
<p><strong><em>NOTE</em></strong> Currently <code><a href="../reference/GUI-utils.html">newProject()</a></code> <em>only</em> works when using RStudio.</p>
</blockquote>
<p>A dialog should pop-up (see screenshot below) where you can specify where and how the new project will be generated, which analyses you want to include and define a basic workflow. Based on this input a new project with a template script will be automatically generated.</p>
<div class="figure">
<img src="newp.png" width="450">
</div>
<p>For this tutorial make the following selections</p>
<ul>
<li>
<strong>Destination tab</strong> Select your desired location of the new project. Leave other settings as they are.</li>
<li>
<strong>Analyses tab</strong> Here you normally select your analyses. However, for this tutorial simply select the <em>Example data</em> option.</li>
<li>
<strong>Data pre-treatment tab</strong> Since the example data is already ready to use you can simply skip this tab.</li>
<li>
<strong>Features tab</strong> Leave the default OpenMS algorithm for feature finding and grouping.</li>
<li>
<strong>Annotation tab</strong> Select <em>GenForm</em>, <em>MetFrag</em> and <em>mzR</em> for the formula generation, compound identification and peak list generator options, respectively (note that the last will become visible when selecting either of the other options). Select <em>RAMClustR</em> for component generation.</li>
<li>
<strong>Reporting tab</strong> Make sure all options are enabled (the <code><a href="../reference/reporting.html">reportPDF()</a></code> and <code><a href="../reference/reporting.html">reportHTML()</a></code> functions largely overlap each other in functionality, but are both enabled for demonstration purposes).</li>
</ul>
</div>
<div id="manual-project-creation" class="section level2">
<h2 class="hasAnchor">
<a href="#manual-project-creation" class="anchor"></a>Manual project creation</h2>
<p>For RStudio users it is easiest to simply create a new RStudio project (e.g. <em>File</em> --&gt; <em>New Project</em>). This will create a new directory and ensure that the working directory is set whenever you re-open it. Alternatively, you can do this manually, for instance:</p>
<div class="sourceCode"><html><body><pre class="r"><span class="no">projDir</span> <span class="kw">&lt;-</span> <span class="st">"~/myProjectDir"</span>
<span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span>(<span class="no">projDir</span>)
<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">setwd</a></span>(<span class="no">projDir</span>)</pre></body></html></div>
<p>The next step is to create a new <code>R</code> script. For this tutorial simply copy the script that is shown in the next section to a new <code>.R</code> file.</p>
</div>
<div id="template-r-script" class="section level2">
<h2 class="hasAnchor">
<a href="#template-r-script" class="anchor"></a>Template R script</h2>
<p>After you ran <code><a href="../reference/GUI-utils.html">newProject()</a></code> the file below will be created. Before running this script, however, we still have to add and modify some of its code. In the next sections you will learn more about each part of the script, make the necessary changes and run its code.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="co">## Script automatically generated on Mon Mar 25 08:24:32 2019</span>

<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">patRoon</span>)


<span class="co"># -------------------------</span>
<span class="co"># initialization</span>
<span class="co"># -------------------------</span>


<span class="no">workPath</span> <span class="kw">&lt;-</span> <span class="st">"C:/myproject"</span>
<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">setwd</a></span>(<span class="no">workPath</span>)

<span class="co"># Take example data from patRoonData package (triplicate solvent blank + triplicate standard)</span>
<span class="no">anaInfo</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/analysis-information.html">generateAnalysisInfo</a></span>(<span class="kw">paths</span> <span class="kw">=</span> <span class="kw pkg">patRoonData</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/patRoonData/man/patRoonData.html">exampleDataPath</a></span>(),
                                <span class="kw">groups</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="st">"solvent"</span>, <span class="fl">3</span>), <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="st">"standard"</span>, <span class="fl">3</span>)),
                                <span class="kw">blanks</span> <span class="kw">=</span> <span class="st">"solvent"</span>)


<span class="co"># -------------------------</span>
<span class="co"># features</span>
<span class="co"># -------------------------</span>


<span class="co"># Find all features.</span>
<span class="co"># NOTE: see manual for many more options</span>
<span class="no">fList</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/feature-finding.html">findFeatures</a></span>(<span class="no">anaInfo</span>, <span class="st">"openms"</span>)

<span class="co"># Group and align features between analysis</span>
<span class="no">fGroups</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/feature-grouping.html">groupFeatures</a></span>(<span class="no">fList</span>, <span class="st">"openms"</span>)

<span class="co"># Basic rule based filtering</span>
<span class="no">fGroups</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/generics.html">filter</a></span>(<span class="no">fGroups</span>, <span class="kw">preAbsMinIntensity</span> <span class="kw">=</span> <span class="fl">100</span>, <span class="kw">absMinIntensity</span> <span class="kw">=</span> <span class="fl">10000</span>,
                  <span class="kw">relMinReplicateAbundance</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">maxReplicateIntRSD</span> <span class="kw">=</span> <span class="fl">0.75</span>,
                  <span class="kw">blankThreshold</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="kw">removeBlanks</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                  <span class="kw">retentionRange</span> <span class="kw">=</span> <span class="kw">NULL</span>, <span class="kw">mzRange</span> <span class="kw">=</span> <span class="kw">NULL</span>)


<span class="co"># -------------------------</span>
<span class="co"># annotation</span>
<span class="co"># -------------------------</span>


<span class="co"># Retrieve MS peak lists</span>
<span class="no">avgPListParams</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/MSPeakLists-generation.html">getDefAvgPListParams</a></span>(<span class="kw">clusterMzWindow</span> <span class="kw">=</span> <span class="fl">0.005</span>)
<span class="no">mslists</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/MSPeakLists-generation.html">generateMSPeakLists</a></span>(<span class="no">fGroups</span>, <span class="st">"mzr"</span>, <span class="kw">maxMSRtWindow</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="kw">precursorMzWindow</span> <span class="kw">=</span> <span class="fl">4</span>,
                               <span class="kw">avgFeatParams</span> <span class="kw">=</span> <span class="no">avgPListParams</span>, <span class="kw">avgFGroupParams</span> <span class="kw">=</span> <span class="no">avgPListParams</span>)
<span class="co"># uncomment and configure for extra filtering of MS peak lists</span>
<span class="co"># mslists &lt;- filter(mslists, absMSIntThr = NULL, absMSMSIntThr = NULL, relMSIntThr = NULL,</span>
<span class="co">#                   relMSMSIntThr = NULL, topMSPeaks = NULL, topMSMSPeaks = NULL,</span>
<span class="co">#                   deIsotopeMS = FALSE, deIsotopeMSMS = FALSE)</span>

<span class="co"># Calculate formula candidates</span>
<span class="no">formulas</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/formula-generation.html">generateFormulas</a></span>(<span class="no">fGroups</span>, <span class="st">"genform"</span>, <span class="no">mslists</span>, <span class="kw">relMzDev</span> <span class="kw">=</span> <span class="fl">5</span>,
                             <span class="kw">adduct</span> <span class="kw">=</span> <span class="st">"[M+H]+"</span>, <span class="kw">elements</span> <span class="kw">=</span> <span class="st">"CHNOP"</span>,
                             <span class="kw">calculateFeatures</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">featThreshold</span> <span class="kw">=</span> <span class="fl">0.75</span>)

<span class="co"># Find compound structure candidates</span>
<span class="no">compounds</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/compound-generation.html">generateCompounds</a></span>(<span class="no">fGroups</span>, <span class="no">mslists</span>, <span class="st">"metfrag"</span>, <span class="kw">method</span> <span class="kw">=</span> <span class="st">"CL"</span>, <span class="kw">dbRelMzDev</span> <span class="kw">=</span> <span class="fl">5</span>,
                               <span class="kw">fragRelMzDev</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="kw">fragAbsMzDev</span> <span class="kw">=</span> <span class="fl">0.002</span>,
                               <span class="kw">adduct</span> <span class="kw">=</span> <span class="st">"[M+H]+"</span>, <span class="kw">database</span> <span class="kw">=</span> <span class="st">"pubchem"</span>, <span class="kw">maxCandidatesToStop</span> <span class="kw">=</span> <span class="fl">2500</span>)
<span class="no">compounds</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/compounds-class.html">addFormulaScoring</a></span>(<span class="no">compounds</span>, <span class="no">formulas</span>, <span class="fl">TRUE</span>)

<span class="co"># Perform automatic generation of components</span>
<span class="no">components</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/component-generation.html">generateComponents</a></span>(<span class="no">fGroups</span>, <span class="st">"ramclustr"</span>, <span class="kw">ionization</span> <span class="kw">=</span> <span class="st">"positive"</span>)


<span class="co"># -------------------------</span>
<span class="co"># reporting</span>
<span class="co"># -------------------------</span>


<span class="fu"><a href="../reference/reporting.html">reportCSV</a></span>(<span class="no">fGroups</span>, <span class="kw">path</span> <span class="kw">=</span> <span class="st">"report"</span>, <span class="kw">reportFeatures</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">formulas</span> <span class="kw">=</span> <span class="no">formulas</span>,
          <span class="kw">compounds</span> <span class="kw">=</span> <span class="no">compounds</span>, <span class="kw">compoundsNormalizeScores</span> <span class="kw">=</span> <span class="st">"max"</span>,
          <span class="kw">components</span> <span class="kw">=</span> <span class="no">components</span>)

<span class="fu"><a href="../reference/reporting.html">reportPDF</a></span>(<span class="no">fGroups</span>, <span class="kw">path</span> <span class="kw">=</span> <span class="st">"report"</span>, <span class="kw">reportFGroups</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">formulas</span> <span class="kw">=</span> <span class="no">formulas</span>, <span class="kw">reportFormulaSpectra</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
          <span class="kw">compounds</span> <span class="kw">=</span> <span class="no">compounds</span>, <span class="kw">compoundsNormalizeScores</span> <span class="kw">=</span> <span class="st">"max"</span>,
          <span class="kw">components</span> <span class="kw">=</span> <span class="no">components</span>, <span class="kw">MSPeakLists</span> <span class="kw">=</span> <span class="no">mslists</span>)

<span class="fu"><a href="../reference/reporting.html">reportHTML</a></span>(<span class="no">fGroups</span>, <span class="kw">path</span> <span class="kw">=</span> <span class="st">"report"</span>, <span class="kw">reportPlots</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"chord"</span>, <span class="st">"venn"</span>, <span class="st">"upset"</span>, <span class="st">"eics"</span>, <span class="st">"formulas"</span>), <span class="kw">formulas</span> <span class="kw">=</span> <span class="no">formulas</span>,
           <span class="kw">compounds</span> <span class="kw">=</span> <span class="no">compounds</span>, <span class="kw">compoundsNormalizeScores</span> <span class="kw">=</span> <span class="st">"max"</span>,
           <span class="kw">components</span> <span class="kw">=</span> <span class="no">components</span>, <span class="kw">MSPeakLists</span> <span class="kw">=</span> <span class="no">mslists</span>,
           <span class="kw">selfContained</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">openReport</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
</div>
</div>
<div id="workflow" class="section level1">
<h1 class="hasAnchor">
<a href="#workflow" class="anchor"></a>Workflow</h1>
<p>Now that you have generated a new project with a template script it is time to make some minor modifications and run it afterwards. In the next sections each major part of the script (initialization, finding and grouping features, annotation and reporting) will be discussed separately. Each section will briefly discuss the code, what needs to be modified and finally you will run the code. In addition, several functions will be demonstrated that you can use to inspect generated data.</p>
<div id="initialization" class="section level2">
<h2 class="hasAnchor">
<a href="#initialization" class="anchor"></a>Initialization</h2>
<p>The first part of the script loads <code>patRoon</code>, makes sure the current working directory is set correctly and loads information about the analyses. This part in your script looks more or less like this:</p>
<div class="sourceCode"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">patRoon</span>)

<span class="no">workPath</span> <span class="kw">&lt;-</span> <span class="st">"C:/my_project"</span>
<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">setwd</a></span>(<span class="no">workPath</span>)


<span class="co"># Take example data from patRoonData package (triplicate solvent blank + triplicate standard)</span>
<span class="no">anaInfo</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/analysis-information.html">generateAnalysisInfo</a></span>(<span class="kw">paths</span> <span class="kw">=</span> <span class="kw pkg">patRoonData</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/patRoonData/man/patRoonData.html">exampleDataPath</a></span>(),
                                <span class="kw">groups</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="st">"solvent"</span>, <span class="fl">3</span>), <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="st">"standard"</span>, <span class="fl">3</span>)),
                                <span class="kw">blanks</span> <span class="kw">=</span> <span class="st">"solvent"</span>)</pre></body></html></div>
<p>After you ran this part the analysis information should be stored in the <code>anaInfo</code> variable. This information is important as it will be required for subsequent steps in the workflow. Lets peek at its contents:</p>
<div class="sourceCode"><html><body><pre class="r"><span class="no">anaInfo</span></pre></body></html></div>
<pre><code>#&gt;                                                path   analysis    group   blank
#&gt; 1 /usr/local/lib/R/site-library/patRoonData/extdata  solvent-1  solvent solvent
#&gt; 2 /usr/local/lib/R/site-library/patRoonData/extdata  solvent-2  solvent solvent
#&gt; 3 /usr/local/lib/R/site-library/patRoonData/extdata  solvent-3  solvent solvent
#&gt; 4 /usr/local/lib/R/site-library/patRoonData/extdata standard-1 standard solvent
#&gt; 5 /usr/local/lib/R/site-library/patRoonData/extdata standard-2 standard solvent
#&gt; 6 /usr/local/lib/R/site-library/patRoonData/extdata standard-3 standard solvent</code></pre>
<p>As you can see the generated <code>data.frame</code> consists of four columns:</p>
<ul>
<li>
<em>path</em>: the directory path of the file containing the analysis data</li>
<li>
<em>analysis</em>: the name of the analysis. This should be the file name <em>without</em> file extension.</li>
<li>
<em>group</em>: to which <em>replicate group</em> the analysis belongs. All analysis which are replicates of each other get the same name.</li>
<li>
<em>blank</em>: which replicate group should be used for blank subtraction.</li>
</ul>
<p>The latter two columns are especially important for <a href="#data-cleanup">data cleanup</a>, which will be discussed later. For now keep in mind that the analyses for the solvents and standards each belong to a different replicate group (<code>"solvent"</code> and <code>"standard"</code>) and that the solvents should be used for blank subtraction.</p>
<p>In this tutorial the analysis information was generated by the <code><a href="../reference/analysis-information.html">generateAnalysisInfo()</a></code> function. This function will scan a given directory for MS data files and automatically fill in the <code>path</code> and <code>analysis</code> columns from this information. In addition, you can pass replicate group and blank information to this function as was done in the code above.</p>
<blockquote>
<p><strong><em>NOTE</em></strong> Of course nothing stops you from creating a <code>data.frame</code> with analysis information manually within <code>R</code> or load the information from a <em>csv</em> file. In fact, when you create a new project with <code><a href="../reference/GUI-utils.html">newProject()</a></code> you can select to generate a separate <em>csv</em> file with analysis information (i.e. by filling in the right information in the analysis tab).</p>
</blockquote>
<blockquote>
<p><strong><em>NOTE</em></strong> The blanks for the solvent analyses are set to themselves. This will remove any features from the solvents later in the workflow, which is generally fine as we are usually not interested in the blanks anyway.</p>
</blockquote>
</div>
</div>
<div id="find-and-group-features" class="section level1">
<h1 class="hasAnchor">
<a href="#find-and-group-features" class="anchor"></a>Find and group features</h1>
<p>The first step of a LC-MS non-target analysis workflow is typically the extraction of so called 'features'. While sometimes slightly different definitions are used, a feature can be seen as a single peak within an extracted ion chromatogram. For a complex sample it is not uncommon that hundreds to thousands of features can extracted. Because these large numbers this process is typically automatized nowadays.</p>
<p>To obtain all the features within your dataset the <code>findFeatures</code> function is used. This function requires data on the analysis information (<code>anaInfo</code> variable created earlier) and the desired algorithm that should be used. On top of that there are many more options that can significantly influence the feature finding process, hence, it is important to evaluate results afterwards.</p>
<p>In this tutorial we will use the <a href="http://openms.de/">OpenMS</a> software to find features and stick with default parameters:</p>
<div class="sourceCode"><html><body><pre class="r"><span class="no">fList</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/feature-finding.html">findFeatures</a></span>(<span class="no">anaInfo</span>, <span class="st">"openms"</span>)</pre></body></html></div>
<pre><code>#&gt; Finding features with OpenMS for 6 analyses ...
#&gt; Done!
#&gt; Feature statistics:
#&gt; solvent-1: 385 (15.8%)
#&gt; solvent-2: 372 (15.2%)
#&gt; solvent-3: 376 (15.4%)
#&gt; standard-1: 437 (17.9%)
#&gt; standard-2: 443 (18.1%)
#&gt; standard-3: 431 (17.6%)
#&gt; Total: 2444</code></pre>
<p>After some processing time (especially for larger datasets), the next step is to <em>group features</em>. During this step, features from different analysis are grouped, optionally after alignment of their retention times. This grouping is necessary because it is common that instrumental errors will result in (slight) variations in both retention time and <em>m/z</em> values which may complicate comparison of features between analyses. The resulting groups are referred to as <strong>feature groups</strong> and are crucial input for subsequent workflow steps.</p>
<p>To group features the <code><a href="../reference/feature-grouping.html">groupFeatures()</a></code> function is used, which has similar argument requirements as <code><a href="../reference/feature-finding.html">findFeatures()</a></code> and likewise has many more options to tune the process.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="no">fGroups</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/feature-grouping.html">groupFeatures</a></span>(<span class="no">fList</span>, <span class="st">"openms"</span>)</pre></body></html></div>
<div id="data-cleanup" class="section level2">
<h2 class="hasAnchor">
<a href="#data-cleanup" class="anchor"></a>Data clean-up</h2>
<p>The next step is to perform some basic rule based filtering with the filter() function. As its name suggests this function has several ways to filter data. It is a so called generic function and methods exists for various data types, such as the feature groups object that was made in the previous section (stored in the the <code>fGroups</code> variable).</p>
<div class="sourceCode"><html><body><pre class="r"><span class="no">fGroups</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/generics.html">filter</a></span>(<span class="no">fGroups</span>, <span class="kw">preAbsMinIntensity</span> <span class="kw">=</span> <span class="fl">100</span>, <span class="kw">absMinIntensity</span> <span class="kw">=</span> <span class="fl">10000</span>,
                  <span class="kw">relMinReplicateAbundance</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">maxReplicateIntRSD</span> <span class="kw">=</span> <span class="fl">0.75</span>,
                  <span class="kw">blankThreshold</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="kw">removeBlanks</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                  <span class="kw">retentionRange</span> <span class="kw">=</span> <span class="kw">NULL</span>, <span class="kw">mzRange</span> <span class="kw">=</span> <span class="kw">NULL</span>)</pre></body></html></div>
<pre><code>#&gt; Applying intensity filter... Done! Filtered 0 (0.00%) groups. Remaining: 593.
#&gt; Applying replicate abundance filter... Done! Filtered 211 (35.58%) groups. Remaining: 382.
#&gt; Applying blank filter... Done! Filtered 287 (75.13%) groups. Remaining: 95.
#&gt; Applying intensity filter... Done! Filtered 58 (61.05%) groups. Remaining: 37.
#&gt; Applying replicate abundance filter... Done! Filtered 3 (8.11%) groups. Remaining: 34.
#&gt; Applying replicate group filter... Done! Filtered 0 (0.00%) groups. Remaining: 34.</code></pre>
<p>The following filterings steps will be performed:</p>
<ul>
<li>Features are removed if their intensity is below a defined intensity threshold (set by <code>absMinIntensity</code>). This filter is an effective way to not only remove 'noisy' data, but, for instance, can also be used to remove any low intensity features which likely miss MS/MS data.</li>
<li>If a feature is not ubiquitously present in (part of) replicate analyses it will be filtered out from that replicate group. This is controlled by setting <code>relMinReplicateAbundance</code>. The value is relative, for instance, a value of <code>0.5</code> would mean that a feature needs to be present in half of the replicates. In this tutorial we use a value of <code>1</code> which means that a feature should be present in all replicate samples. This is a <em>very</em> effective filter in removing any outliers, for instance, caused by features which don't actually represent a well defined chromatographic peak.</li>
<li>Similarly, features with within a replicate group are removed if the relative standard deviation (RSD) of their intensities exceeds that of the value set by the <code>maxReplicateIntRSD</code> argument.</li>
<li>Features are filtered out that do not have a significantly higher intensity than the blank intensity. This is controlled by <code>blankThreshold</code>: the given value of <code>5</code> means that the intensity of a feature needs to be at least five times higher compared to the (average) blank signal.</li>
</ul>
<p>The <code>removeBlanks</code> argument tells will remove all blank analyses after filtering. The <code>retentionRange</code> and <code>mzRange</code> arguments are not used here, but could be used to filter out any features outside a give retention or <em>m/z</em> range. There are many more filters: see <code>?filter()</code> for more information.</p>
<p>As you may have noticed quite a large part of the features are removed as a result of the filtering step. However, using the right settings is a very effective way to separate interesting data from the rest.</p>
<!-- UNDONE: add link below to other vignette when it contains prioritization -->
<p>The next logical step in a non-target workflow is often to perform further prioritization of data. However, this will not be necessary in this tutorial as our samples are just known standard mixtures.</p>
</div>
<div id="inspecting-results" class="section level2">
<h2 class="hasAnchor">
<a href="#inspecting-results" class="anchor"></a>Inspecting results</h2>
<p>In order to have a quick peek at the results we can use the default printing method:</p>
<div class="sourceCode"><html><body><pre class="r"><span class="no">fGroups</span></pre></body></html></div>
<pre><code>#&gt; A featureGroupsOpenMS object (derived from featureGroups -&gt; workflowStep)
#&gt; Object size (indication): 240.5 kB
#&gt; Algorithm: openms
#&gt; Feature groups: M109_R116_56, M120_R328_81, M134_R399_118, M135_R261_123, M137_R303_127, M142_R116_141, ... (34 total)
#&gt; Analyses: standard-1, standard-2, standard-3 (3 total)
#&gt; Replicate groups: standard (1 total)
#&gt; Replicate groups used as blank: solvent (1 total)</code></pre>
<p>Furthermore, the <code><a href="../reference/generics.html">as.data.table()</a></code> function can be used to have a look at generated feature groups and their intensities (<em>i.e.</em> peak heights) across all analyses:</p>
<div class="sourceCode"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fu"><a href="../reference/generics.html">as.data.table</a></span>(<span class="no">fGroups</span>))</pre></body></html></div>
<pre><code>#&gt;            group      ret       mz standard-1 standard-2 standard-3
#&gt; 1:  M109_R116_56 116.0809 109.0759      12064      12080      10996
#&gt; 2:  M120_R328_81 327.9955 120.0555      55936      61668      59624
#&gt; 3: M134_R399_118 398.6365 134.0712      84880      75580      74956
#&gt; 4: M135_R261_123 260.5933 135.1014      15696      16476      16804
#&gt; 5: M137_R303_127 302.7823 137.0708      40272      46436      44724
#&gt; 6: M142_R116_141 116.0809 141.9584      26424      25876      27816</code></pre>
<p>An overview of group properties is returned by the <code><a href="../reference/featureGroups-class.html">groupInfo()</a></code> method:</p>
<div class="sourceCode"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fu"><a href="../reference/featureGroups-class.html">groupInfo</a></span>(<span class="no">fGroups</span>))</pre></body></html></div>
<pre><code>#&gt;                    rts      mzs
#&gt; M109_R116_56  116.0809 109.0759
#&gt; M120_R328_81  327.9955 120.0555
#&gt; M134_R399_118 398.6365 134.0712
#&gt; M135_R261_123 260.5933 135.1014
#&gt; M137_R303_127 302.7823 137.0708
#&gt; M142_R116_141 116.0809 141.9584</code></pre>
<p>Finally, we can have a quick look at our data by plotting some nice extracted ion chromatograms (EICs) for all feature groups:</p>
<div class="sourceCode"><html><body><pre class="r"><span class="fu"><a href="../reference/generics.html">plotEIC</a></span>(<span class="no">fGroups</span>, <span class="kw">colourBy</span> <span class="kw">=</span> <span class="st">"fGroups"</span>, <span class="kw">showFGroupRect</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">showPeakArea</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
        <span class="kw">topMost</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">showLegend</span> <span class="kw">=</span> <span class="fl">FALSE</span>)</pre></body></html></div>
<p><img src="tutorial_files/figure-html/plotEIC-1.png" width="672"></p>
<p>Note that here we only plot the most intense feature of a feature group here (as set by <code>topMost=1</code>). See the reference docs for many more parameters to these functions (e.g. <code><a href="../reference/generics.html">?plotEIC</a></code>).</p>
</div>
</div>
<div id="annotation" class="section level1">
<h1 class="hasAnchor">
<a href="#annotation" class="anchor"></a>Annotation</h1>
<div id="ms-peak-lists" class="section level2">
<h2 class="hasAnchor">
<a href="#ms-peak-lists" class="anchor"></a>MS peak lists</h2>
<p>After obtaining a good dataset with features of interest we can start moving to find their chemical identity. Before doing so, however, the first step is to extract all relevant MS data that will be used for annotation. The tutorial data was obtained with data-dependent MS/MS, so in the ideal case we can obtain both MS and MS/MS data for each feature group.</p>
<p>The <code><a href="../reference/MSPeakLists-generation.html">generateMSPeakLists()</a></code> function will perform this action for us and will generate so called <em>MS peak lists</em> in the process. These lists are basically (averaged) spectra in a tabular form. We will use algorithms from the <a href="https://bioconductor.org/packages/release/bioc/html/mzR.html">mzR</a> package to do so:</p>
<div class="sourceCode"><html><body><pre class="r"><span class="no">avgPListParams</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/MSPeakLists-generation.html">getDefAvgPListParams</a></span>(<span class="kw">clusterMzWindow</span> <span class="kw">=</span> <span class="fl">0.002</span>)
<span class="no">mslists</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/MSPeakLists-generation.html">generateMSPeakLists</a></span>(<span class="no">fGroups</span>, <span class="st">"mzr"</span>, <span class="kw">maxMSRtWindow</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="kw">precursorMzWindow</span> <span class="kw">=</span> <span class="fl">4</span>,
                              <span class="kw">avgFeatParams</span> <span class="kw">=</span> <span class="no">avgPListParams</span>, <span class="kw">avgFGroupParams</span> <span class="kw">=</span> <span class="no">avgPListParams</span>)</pre></body></html></div>
<pre><code>#&gt; Loading all MS peak lists for 34 feature groups in analysis 'standard-1'...
#&gt; ============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
#&gt; Loading all MS peak lists for 34 feature groups in analysis 'standard-2'...
#&gt; ============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
#&gt; Loading all MS peak lists for 34 feature groups in analysis 'standard-3'...
#&gt; ============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
#&gt; Generating averaged peak lists for all feature groups...
#&gt; ============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================</code></pre>
<p>Note that we lowered the <code>clusterMzWindow</code> value to <em>0.002</em>. This window is used during averaging to cluster similar <em>m/z</em> values together. In general the better the resolution of your MS instrument, the lower the value can be set.</p>
<p>Similar to feature groups the <code><a href="../reference/generics.html">filter()</a></code> generic function can be used to clean up the peak lists afterwards:</p>
<div class="sourceCode"><html><body><pre class="r"><span class="no">mslists</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/generics.html">filter</a></span>(<span class="no">mslists</span>, <span class="kw">relMSMSIntThr</span> <span class="kw">=</span> <span class="fl">0.02</span>, <span class="kw">topMSMSPeaks</span> <span class="kw">=</span> <span class="fl">10</span>)</pre></body></html></div>
<pre><code>#&gt; Filtering MS peak lists for 34 feature groups in analysis 'standard-1'...
#&gt; ============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
#&gt; Filtering MS peak lists for 34 feature groups in analysis 'standard-2'...
#&gt; ============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
#&gt; Filtering MS peak lists for 34 feature groups in analysis 'standard-3'...
#&gt; ============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
#&gt; Generating averaged peak lists for all feature groups...
#&gt; ============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
#&gt; Filtering averaged MS peak lists for 34 feature groups...
#&gt; ============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
#&gt; Done! Filtered 345 (5.34%) MS peaks. Remaining: 6120</code></pre>
<p>Here, all MS/MS mass peaks with intensities below 2% are removed and from the remaining peaks no more than the ten most intense are retained.</p>
</div>
<div id="formula-calculation" class="section level2">
<h2 class="hasAnchor">
<a href="#formula-calculation" class="anchor"></a>Formula calculation</h2>
<p>Using the data from the MS peak lists generated during the previous step we can generate a list of formula candidates for each feature group which is based on measured <em>m/z</em> values, isotopic patterns and presence of MS/MS fragments. In this tutorial we will use this data as an extra hint to score candidate chemical structures generated during the next step. The command below will use <a href="https://sourceforge.net/projects/genform/">GenForm</a> to perform this step. Again running this code may take some time.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="no">formulas</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/formula-generation.html">generateFormulas</a></span>(<span class="no">fGroups</span>, <span class="st">"genform"</span>, <span class="no">mslists</span>, <span class="kw">relMzDev</span> <span class="kw">=</span> <span class="fl">5</span>,
                             <span class="kw">adduct</span> <span class="kw">=</span> <span class="st">"[M+H]+"</span>, <span class="kw">elements</span> <span class="kw">=</span> <span class="st">"CHNOPSCl"</span>,
                             <span class="kw">calculateFeatures</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">featThreshold</span> <span class="kw">=</span> <span class="fl">0.75</span>)</pre></body></html></div>
<pre><code>#&gt; Loading all formulas for analysis 'standard-1'...
#&gt; ============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
#&gt; Loaded 176 formulas for 32 features (94.12%).
#&gt; Loading all formulas for analysis 'standard-2'...
#&gt; ============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
#&gt; Loaded 177 formulas for 32 features (94.12%).
#&gt; Loading all formulas for analysis 'standard-3'...
#&gt; ============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
#&gt; Loaded 172 formulas for 32 features (94.12%).
#&gt; Generating feature group formula consensus...
#&gt; ============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================</code></pre>
<p>Note that you need to change the elements parameter to this function to make sure that formulae with sulfur and chloride (S/Cl) are also accepted. It is highly recommended to limit the elements (by default it is just C, H, N, O and P) as this can significantly reduce processing time and improbable formula candidates. In this tutorial we already knew which compounds to expect so the choice was easy, but often a good guess can be made in advance.</p>
<blockquote>
<p><strong><em>NOTE</em></strong> The <code><a href="../reference/formula-generation.html">generateFormulas()</a></code> function returns an object that contains formula candidates assigned for each feature group. In the above call the <code>calculateFeatures</code> argument is set to <code>TRUE</code>: by doing so formulae are first calculated for individual features within a feature group. These results are then used to generate a consensus candidate formula list for the complete feature group. During this process any outliers (defined by <code>featThreshold</code>) are automatically removed. In contrast, setting <code>calculateFeatures</code> to <code>FALSE</code> will calculate formulae directly for feature groups (by using MS peak lists that have been averaged for the whole group). This will be significantly faster, but might produce (slightly) less accurate results.</p>
</blockquote>
</div>
<div id="compound-identification" class="section level2">
<h2 class="hasAnchor">
<a href="#compound-identification" class="anchor"></a>Compound identification</h2>
<!-- UNDONE Move MF installation to front? -->
<p>Now it is time to actually see what compounds we may be dealing with. In this tutorial we will use <a href="http://ipb-halle.github.io/MetFrag/">MetFrag</a> to come up with a list of possible candidates structures for each feature group. Before we can start you have to make sure that MetFrag can be found by <code>patRoon</code>. Download the <a href="http://ipb-halle.github.io/MetFrag/projects/metfragcl/">MetFrag CLI jar file</a> and specify its file location:</p>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># change to the full path of the MetFrag CL jar file</span>
<span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span>(<span class="kw">patRoon.path.MetFragCL</span> <span class="kw">=</span> <span class="st">"~/MetFrag2.4.5-CL.jar"</span>)</pre></body></html></div>
<p>Then <code><a href="../reference/compound-generation.html">generateCompounds()</a></code> is used to execute MetFrag and generate the <code>compounds</code>.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="no">compounds</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/compound-generation.html">generateCompounds</a></span>(<span class="no">fGroups</span>, <span class="no">mslists</span>, <span class="st">"metfrag"</span>, <span class="kw">method</span> <span class="kw">=</span> <span class="st">"CL"</span>,
                               <span class="kw">dbRelMzDev</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="kw">fragRelMzDev</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="kw">fragAbsMzDev</span> <span class="kw">=</span> <span class="fl">0.002</span>,
                               <span class="kw">adduct</span> <span class="kw">=</span> <span class="st">"[M+H]+"</span>, <span class="kw">database</span> <span class="kw">=</span> <span class="st">"pubchem"</span>, <span class="kw">maxCandidatesToStop</span> <span class="kw">=</span> <span class="fl">5000</span>)</pre></body></html></div>
<pre><code>#&gt; Identifying 34 feature groups with MetFrag...
#&gt; ============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
#&gt; Loaded 2214 compounds from 23 features (67.65%).</code></pre>
<p>While <code><a href="../reference/compound-generation.html">generateCompounds()</a></code> is running a list of candidate compound structures will be downloaded for every feature group and ranked according to various scoring parameters.</p>
<p>In this case we are using the <a href="https://pubchem.ncbi.nlm.nih.gov/">PubChem</a> database to retrieve candidates. Other commonly databases are <a href="http://www.chemspider.com/">ChemSpider</a> and EPA's <a href="https://comptox.epa.gov/dashboard">CompTox</a>. See <code>?generateCompounds()</code> for more information on possible databases and many other parameters that can be set.</p>
<blockquote>
<p><strong><em>NOTE</em></strong> You may get several warnings for feature groups for which no compounds could be searched. Usually this is because we set a hard limit with the <code>maxCandidatesToStop</code> argument. Increasing this value is tempting, however, the compounds are searched through an online database and processing thousands of candidates takes too much time (and is not nice towards the servers running MetFrag!). An obvious drawback is that you will not get any results for feature groups with many candidates (however, these are generally difficult to sort out anyway!).</p>
</blockquote>
<blockquote>
<p><strong><em>NOTE</em></strong> This is often one of the most time consuming steps during the workflow. For this reason, and in order to not 'abuse' the servers used by MetFrag, you should always take care to prioritize your data before running this function!</p>
</blockquote>
<p>Finally we use the <code><a href="../reference/compounds-class.html">addFormulaScoring()</a></code> function to improve ranking of candidates by incorporating the formula calculation data from the previous step.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="no">compounds</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/compounds-class.html">addFormulaScoring</a></span>(<span class="no">compounds</span>, <span class="no">formulas</span>, <span class="kw">updateScore</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<pre><code>#&gt; Adding formula scoring...
#&gt; ============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================</code></pre>
</div>
<div id="inspecting-results-1" class="section level2">
<h2 class="hasAnchor">
<a href="#inspecting-results-1" class="anchor"></a>Inspecting results</h2>
<p>Similar as feature groups we can quickly peek at some results:</p>
<div class="sourceCode"><html><body><pre class="r"><span class="no">mslists</span></pre></body></html></div>
<pre><code>#&gt; A MSPeakLists object (derived from workflowStep)
#&gt; Object size (indication): 2.8 MB
#&gt; Algorithm: mzr
#&gt; Total peak count: 6120 (MS: 5528 - MS/MS: 592)
#&gt; Average peak count/analysis: 2040 (MS: 1843 - MS/MS: 197)
#&gt; Total peak lists: 185 (MS: 102 - MS/MS: 83)
#&gt; Average peak lists/analysis: 62 (MS: 34 - MS/MS: 28)</code></pre>
<div class="sourceCode"><html><body><pre class="r"><span class="no">formulas</span></pre></body></html></div>
<pre><code>#&gt; A formulas object (derived from workflowStep)
#&gt; Object size (indication): 854.7 kB
#&gt; Algorithm: genform
#&gt; Formulas assigned to features:
#&gt;   - Total formula count: 525
#&gt;   - Average formulas per analysis: 5.5
#&gt;   - Average formulas per feature: 5.5
#&gt; Formulas assigned to feature groups:
#&gt;   - Total formula count: 131
#&gt;   - Average formulas per feature group: 4.1</code></pre>
<div class="sourceCode"><html><body><pre class="r"><span class="no">compounds</span></pre></body></html></div>
<pre><code>#&gt; A compoundsMF object (derived from compounds -&gt; workflowStep)
#&gt; Object size (indication): 7.2 MB
#&gt; Algorithm: metfrag
#&gt; Number of feature groups with compounds in this object: 23
#&gt; Number of compounds: 2214 (total), 96.3 (mean), 14 - 100 (min - max)</code></pre>
<div class="sourceCode"><html><body><pre class="r"><span class="fu"><a href="../reference/generics.html">as.data.table</a></span>(<span class="no">mslists</span>)</pre></body></html></div>
<pre><code>#&gt;              group type        mz  intensity precursor
#&gt;    1: M109_R116_56   MS  79.02100  2390.4646     FALSE
#&gt;    2: M109_R116_56   MS  84.95949  3745.9596     FALSE
#&gt;    3: M109_R116_56   MS  88.96836  1574.3283     FALSE
#&gt;    4: M109_R116_56   MS  93.00019   704.0455     FALSE
#&gt;    5: M109_R116_56   MS  97.96868  6248.0354     FALSE
#&gt;   ---                                                 
#&gt; 1668: M293_R11_583   MS 272.94389 10122.1587     FALSE
#&gt; 1669: M293_R11_583   MS 288.92212 98753.7460     FALSE
#&gt; 1670: M293_R11_583   MS 290.26895 20768.1905     FALSE
#&gt; 1671: M293_R11_583   MS 293.20852  6051.2698      TRUE
#&gt; 1672: M293_R11_583   MS 294.93889 54849.9683     FALSE</code></pre>
<div class="sourceCode"><html><body><pre class="r"><span class="fu"><a href="../reference/generics.html">as.data.table</a></span>(<span class="no">formulas</span>)[, <span class="fl">1</span>:<span class="fl">7</span>] <span class="co"># only show first columns for clarity</span></pre></body></html></div>
<pre><code>#&gt;              group   analysis neutral_formula     formula formula_mz     error dbe
#&gt;   1:  M109_R116_56 standard-1          C6H8N2      C6H9N2   109.0760  0.500000   4
#&gt;   2:  M109_R116_56 standard-1          C6H8N2      C6H9N2   109.0760  0.500000   4
#&gt;   3:  M109_R116_56 standard-1          C6H8N2      C6H9N2   109.0760  0.500000   4
#&gt;   4:  M109_R116_56 standard-1          C6H8N2      C6H9N2   109.0760  0.500000   4
#&gt;   5:  M109_R116_56 standard-1          C6H8N2      C6H9N2   109.0760  0.500000   4
#&gt;  ---                                                                              
#&gt; 283: M279_R284_557 standard-1      C4H10N10O5  C4H11N10O5   279.0908 -2.400000   5
#&gt; 284: M279_R284_557 standard-1     C13H20Cl2O2 C13H21Cl2O2   279.0913 -0.700000   3
#&gt; 285:  M293_R11_583 standard-1       C8H25N10P   C8H26N10P   293.2074 -3.833333   2
#&gt; 286:  M293_R11_583 standard-1       C14H24N6O   C14H25N6O   293.2084 -0.300000   6
#&gt; 287:  M293_R11_583 standard-1      C14H32N2S2  C14H33N2S2   293.2080 -1.900000   0</code></pre>
<div class="sourceCode"><html><body><pre class="r"><span class="fu"><a href="../reference/generics.html">as.data.table</a></span>(<span class="no">compounds</span>)[, <span class="fl">1</span>:<span class="fl">5</span>] <span class="co"># only show first columns for clarity</span></pre></body></html></div>
<pre><code>#&gt;               group explainedPeaks    score neutralMass                               SMILES
#&gt;    1:  M109_R116_56              3 4.483028    108.0687                    C1=CC=C(C(=C1)N)N
#&gt;    2:  M109_R116_56              3 3.980290    108.0687                      C1=CC(=CC=C1N)N
#&gt;    3:  M109_R116_56              3 3.447238    108.0687                      C1=CC=C(C=C1)NN
#&gt;    4:  M109_R116_56              3 3.275154    108.0687                    C1=CC(=CC(=C1)N)N
#&gt;    5:  M109_R116_56              3 2.970339    108.0687                      CC1=NC(=CC=C1)N
#&gt;   ---                                                                                       
#&gt; 2210: M254_R321_484              3 2.492776    253.0521 CC1=C(C=C(C=C1)N)S(=O)(=O)NC2=NOC=C2
#&gt; 2211: M254_R321_484              5 2.492690    253.0521   CC1=NN=C(O1)C2=CC=CC=C2NS(=O)(=O)C
#&gt; 2212: M254_R321_484              4 2.489731    253.0521 CC(C#N)S(=O)(=O)NC1=CC=C(C=C1)C(=O)N
#&gt; 2213: M254_R321_484              5 2.488391    253.0521   CC1=NOC(=N1)C2=CC=CC=C2NS(=O)(=O)C
#&gt; 2214: M254_R321_484              3 2.486534    253.0521   CNC1=CC=C(C=C1)S(=O)(=O)NC2=NOC=C2</code></pre>
<div class="sourceCode"><html><body><pre class="r"><span class="fu"><a href="../reference/generics.html">plotSpec</a></span>(<span class="no">mslists</span>, <span class="st">"M186_R265_296"</span>, <span class="kw">MSLevel</span> <span class="kw">=</span> <span class="fl">2</span>)</pre></body></html></div>
<p><img src="tutorial_files/figure-html/plotSpec-1.png" width="576"></p>
<div class="sourceCode"><html><body><pre class="r"><span class="fu"><a href="../reference/generics.html">plotSpec</a></span>(<span class="no">formulas</span>, <span class="st">"C6H9N2"</span>, <span class="st">"M109_R116_56"</span>, <span class="kw">MSPeakLists</span> <span class="kw">=</span> <span class="no">mslists</span>)</pre></body></html></div>
<p><img src="tutorial_files/figure-html/plotSpec-2.png" width="576"></p>
<div class="sourceCode"><html><body><pre class="r"><span class="fu"><a href="../reference/generics.html">plotSpec</a></span>(<span class="no">compounds</span>, <span class="fl">1</span>, <span class="st">"M120_R328_81"</span>, <span class="no">mslists</span>)</pre></body></html></div>
<p><img src="tutorial_files/figure-html/plotSpec-3.png" width="576"></p>
</div>
</div>
<div id="components" class="section level1">
<h1 class="hasAnchor">
<a href="#components" class="anchor"></a>Components</h1>
<p>So far we mainly dealt with feature groups as if they are separate chemical compounds. However, formation of multiple ionization adducts (<em>e.g.</em> from sodium and potassium), isotopologues and/or in-source fragments may yield multiple <em>m/z</em> values for the same compound. As a result, multiple feature groups may be describing the same chemical compound. To reduce this complexity it is useful to generate so called <em>components</em> which are basically groups of feature groups which are likely to be the same compound (based on <em>e.g.</em> similarity of retention profiles). Afterwards, feature groups present in a component are annotated based on known chemical rules, which may further help compound identification.</p>
<p>Generating components is performed with the <code><a href="../reference/component-generation.html">generateComponents()</a></code> function:</p>
<div class="sourceCode"><html><body><pre class="r"><span class="no">components</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/component-generation.html">generateComponents</a></span>(<span class="no">fGroups</span>, <span class="st">"ramclustr"</span>, <span class="kw">ionization</span> <span class="kw">=</span> <span class="st">"positive"</span>)</pre></body></html></div>
<pre><code>#&gt; Generating components with RAMClustR...
#&gt;   organizing dataset 
#&gt;   normalizing dataset 
#&gt; calculating ramclustR similarity: nblocks =  1 
#&gt; 1  
#&gt;  RAMClust feature similarity matrix calculated and stored: 
#&gt; RAMClust distances converted to distance object 
#&gt; fastcluster based clustering complete 
#&gt; dynamicTreeCut based pruning complete 
#&gt; RAMClust has condensed 34 features into 11 spectra 
#&gt; collapsing feature into spectral signal intensities 
#&gt; Annotating components...
#&gt; 10 of 11 
#&gt; finished</code></pre>
<p>The results can be inspected similarly as seen before:</p>
<div class="sourceCode"><html><body><pre class="r"><span class="no">components</span></pre></body></html></div>
<pre><code>#&gt; A componentsRC object (derived from components -&gt; workflowStep)
#&gt; Object size (indication): 214.5 kB
#&gt; Algorithm: ramclustr
#&gt; Components: CMP1, CMP2, CMP3, CMP4, CMP5, CMP6, ... (11 total)
#&gt; Number of feature groups in components: 28 (total), 2.5 (mean), 2 - 5 (min - max)</code></pre>
<div class="sourceCode"><html><body><pre class="r"><span class="fu"><a href="../reference/generics.html">plotSpec</a></span>(<span class="no">components</span>, <span class="st">"CMP6"</span>)</pre></body></html></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-4-1.png" width="480"></p>
<div class="sourceCode"><html><body><pre class="r"><span class="fu"><a href="../reference/generics.html">plotEIC</a></span>(<span class="no">components</span>, <span class="st">"CMP6"</span>, <span class="no">fGroups</span>)</pre></body></html></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-4-2.png" width="480"></p>
<blockquote>
<p><strong><em>NOTE</em></strong> The componentization process must currently be seen as a tool to provide hints on how different features <em>may</em> be related to each other. Hence, results should always be checked manually, for instance, by the above commands or with the reports generated in the next step. For this reason, features that were annotated as e.g. adducts or fragments should not be blindly removed.</p>
</blockquote>
</div>
<div id="reporting" class="section level1">
<h1 class="hasAnchor">
<a href="#reporting" class="anchor"></a>Reporting</h1>
<p>The last step of the workflow is typically reporting data: during this step all the collected data is transformed to graphical plots (<code><a href="../reference/reporting.html">reportPDF()</a></code> and <code><a href="../reference/reporting.html">reportHTML()</a></code>) or tabular csv data (<code><a href="../reference/reporting.html">reportCSV()</a></code>).</p>
<div class="sourceCode"><html><body><pre class="r"><span class="fu"><a href="../reference/reporting.html">reportCSV</a></span>(<span class="no">fGroups</span>, <span class="kw">path</span> <span class="kw">=</span> <span class="st">"report"</span>, <span class="kw">reportFeatures</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">formulas</span> <span class="kw">=</span> <span class="no">formulas</span>,
          <span class="kw">compounds</span> <span class="kw">=</span> <span class="no">compounds</span>, <span class="kw">compoundsNormalizeScores</span> <span class="kw">=</span> <span class="st">"max"</span>,
          <span class="kw">components</span> <span class="kw">=</span> <span class="no">components</span>)

<span class="fu"><a href="../reference/reporting.html">reportPDF</a></span>(<span class="no">fGroups</span>, <span class="kw">path</span> <span class="kw">=</span> <span class="st">"report"</span>, <span class="kw">reportFGroups</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">formulas</span> <span class="kw">=</span> <span class="no">formulas</span>, <span class="kw">reportFormulaSpectra</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
          <span class="kw">compounds</span> <span class="kw">=</span> <span class="no">compounds</span>, <span class="kw">compoundsNormalizeScores</span> <span class="kw">=</span> <span class="st">"max"</span>,
          <span class="kw">components</span> <span class="kw">=</span> <span class="no">components</span>, <span class="kw">MSPeakLists</span> <span class="kw">=</span> <span class="no">mslists</span>)

<span class="fu"><a href="../reference/reporting.html">reportHTML</a></span>(<span class="no">fGroups</span>, <span class="kw">path</span> <span class="kw">=</span> <span class="st">"report"</span>, <span class="kw">reportPlots</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"chord"</span>, <span class="st">"venn"</span>, <span class="st">"upset"</span>, <span class="st">"eics"</span>, <span class="st">"formulas"</span>),
           <span class="kw">formulas</span> <span class="kw">=</span> <span class="no">formulas</span>, <span class="kw">compounds</span> <span class="kw">=</span> <span class="no">compounds</span>, <span class="kw">compoundsNormalizeScores</span> <span class="kw">=</span> <span class="st">"max"</span>,
           <span class="kw">components</span> <span class="kw">=</span> <span class="no">components</span>, <span class="kw">MSPeakLists</span> <span class="kw">=</span> <span class="no">mslists</span>,
           <span class="kw">selfContained</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">openReport</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<p>The output of <code><a href="../reference/reporting.html">reportHTML()</a></code> can be viewed <a href="../examples/report.html">here</a>.</p>
<p>Note that these functions can be called at any time during the workflow. This may be especially useful if you want evaluate results during optimization or exploring the various algorithms and their parameters. In this case you can simply cherry pick the data that you want to report, for instance:</p>
<div class="sourceCode"><html><body><pre class="r"># only report feature groups (i.e. the bare minimum)
reportCSV(fGroups, path = "report", reportFeatures = FALSE)

# report compounds. Note that MSPeakLists (mslists variable) are required for formula/compound reporting
reportPDF(fGroups, path = "report", reportFGroups = TRUE,
          compounds = compounds, compoundsNormalizeScores = "max",
          MSPeakLists = mslists)

# only report components
reportHTML(fGroups, path = "report", reportPlots = c("chord", "venn", "upset", "eics"),
           components = components
           selfContained = FALSE, openReport = TRUE)</pre></body></html></div>
</div>
<div id="final-script" class="section level1">
<h1 class="hasAnchor">
<a href="#final-script" class="anchor"></a>Final script</h1>
<p>In the previous sections the different parts of the processing script were discussed and where necessary modified. As a reference, the final script look similar ot this:</p>
<div class="sourceCode"><html><body><pre class="r"><span class="co">## Script automatically generated on Mon Mar 25 08:24:32 2019</span>

<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">patRoon</span>)


<span class="co"># -------------------------</span>
<span class="co"># initialization</span>
<span class="co"># -------------------------</span>


<span class="no">workPath</span> <span class="kw">&lt;-</span> <span class="st">"C:/myproject"</span>
<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">setwd</a></span>(<span class="no">workPath</span>)

<span class="co"># Take example data from patRoonData package (triplicate solvent blank + triplicate standard)</span>
<span class="no">anaInfo</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/analysis-information.html">generateAnalysisInfo</a></span>(<span class="kw">paths</span> <span class="kw">=</span> <span class="kw pkg">patRoonData</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/patRoonData/man/patRoonData.html">exampleDataPath</a></span>(),
                                <span class="kw">groups</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="st">"solvent"</span>, <span class="fl">3</span>), <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="st">"standard"</span>, <span class="fl">3</span>)),
                                <span class="kw">blanks</span> <span class="kw">=</span> <span class="st">"solvent"</span>)


<span class="co"># -------------------------</span>
<span class="co"># features</span>
<span class="co"># -------------------------</span>


<span class="co"># Find all features.</span>
<span class="co"># NOTE: see manual for many more options</span>
<span class="no">fList</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/feature-finding.html">findFeatures</a></span>(<span class="no">anaInfo</span>, <span class="st">"openms"</span>)

<span class="co"># Group and align features between analysis</span>
<span class="no">fGroups</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/feature-grouping.html">groupFeatures</a></span>(<span class="no">fList</span>, <span class="st">"openms"</span>)

<span class="co"># Basic rule based filtering</span>
<span class="no">fGroups</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/generics.html">filter</a></span>(<span class="no">fGroups</span>, <span class="kw">preAbsMinIntensity</span> <span class="kw">=</span> <span class="fl">100</span>, <span class="kw">absMinIntensity</span> <span class="kw">=</span> <span class="fl">10000</span>,
                  <span class="kw">relMinReplicateAbundance</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">maxReplicateIntRSD</span> <span class="kw">=</span> <span class="fl">0.75</span>,
                  <span class="kw">blankThreshold</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="kw">removeBlanks</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                  <span class="kw">retentionRange</span> <span class="kw">=</span> <span class="kw">NULL</span>, <span class="kw">mzRange</span> <span class="kw">=</span> <span class="kw">NULL</span>)


<span class="co"># -------------------------</span>
<span class="co"># annotation</span>
<span class="co"># -------------------------</span>


<span class="co"># Retrieve MS peak lists</span>
<span class="no">avgPListParams</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/MSPeakLists-generation.html">getDefAvgPListParams</a></span>(<span class="kw">clusterMzWindow</span> <span class="kw">=</span> <span class="fl">0.002</span>)
<span class="no">mslists</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/MSPeakLists-generation.html">generateMSPeakLists</a></span>(<span class="no">fGroups</span>, <span class="st">"mzr"</span>, <span class="kw">maxMSRtWindow</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="kw">precursorMzWindow</span> <span class="kw">=</span> <span class="fl">4</span>,
                               <span class="kw">avgFeatParams</span> <span class="kw">=</span> <span class="no">avgPListParams</span>, <span class="kw">avgFGroupParams</span> <span class="kw">=</span> <span class="no">avgPListParams</span>)
<span class="no">mslists</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/generics.html">filter</a></span>(<span class="no">mslists</span>, <span class="kw">relMSMSIntThr</span> <span class="kw">=</span> <span class="fl">0.02</span>, <span class="kw">topMSMSPeaks</span> <span class="kw">=</span> <span class="fl">10</span>)

<span class="co"># Calculate formula candidates</span>
<span class="no">formulas</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/formula-generation.html">generateFormulas</a></span>(<span class="no">fGroups</span>, <span class="st">"genform"</span>, <span class="no">mslists</span>, <span class="kw">relMzDev</span> <span class="kw">=</span> <span class="fl">5</span>,
                             <span class="kw">adduct</span> <span class="kw">=</span> <span class="st">"[M+H]+"</span>, <span class="kw">elements</span> <span class="kw">=</span> <span class="st">"CHNOPSCl"</span>,
                             <span class="kw">calculateFeatures</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">featThreshold</span> <span class="kw">=</span> <span class="fl">0.75</span>)

<span class="co"># Find compound structure candidates</span>
<span class="no">compounds</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/compound-generation.html">generateCompounds</a></span>(<span class="no">fGroups</span>, <span class="no">mslists</span>, <span class="st">"metfrag"</span>, <span class="kw">method</span> <span class="kw">=</span> <span class="st">"CL"</span>, <span class="kw">dbRelMzDev</span> <span class="kw">=</span> <span class="fl">5</span>,
                               <span class="kw">fragRelMzDev</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="kw">fragAbsMzDev</span> <span class="kw">=</span> <span class="fl">0.002</span>,
                               <span class="kw">adduct</span> <span class="kw">=</span> <span class="st">"[M+H]+"</span>, <span class="kw">database</span> <span class="kw">=</span> <span class="st">"pubchem"</span>, <span class="kw">maxCandidatesToStop</span> <span class="kw">=</span> <span class="fl">5000</span>)
<span class="no">compounds</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/compounds-class.html">addFormulaScoring</a></span>(<span class="no">compounds</span>, <span class="no">formulas</span>, <span class="fl">TRUE</span>)

<span class="co"># Perform automatic generation of components</span>
<span class="no">components</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/component-generation.html">generateComponents</a></span>(<span class="no">fGroups</span>, <span class="st">"ramclustr"</span>, <span class="kw">ionization</span> <span class="kw">=</span> <span class="st">"positive"</span>)


<span class="co"># -------------------------</span>
<span class="co"># reporting</span>
<span class="co"># -------------------------</span>


<span class="fu"><a href="../reference/reporting.html">reportCSV</a></span>(<span class="no">fGroups</span>, <span class="kw">path</span> <span class="kw">=</span> <span class="st">"report"</span>, <span class="kw">reportFeatures</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">formulas</span> <span class="kw">=</span> <span class="no">formulas</span>,
          <span class="kw">compounds</span> <span class="kw">=</span> <span class="no">compounds</span>, <span class="kw">compoundsNormalizeScores</span> <span class="kw">=</span> <span class="st">"max"</span>,
          <span class="kw">components</span> <span class="kw">=</span> <span class="no">components</span>)

<span class="fu"><a href="../reference/reporting.html">reportPDF</a></span>(<span class="no">fGroups</span>, <span class="kw">path</span> <span class="kw">=</span> <span class="st">"report"</span>, <span class="kw">reportFGroups</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">formulas</span> <span class="kw">=</span> <span class="no">formulas</span>, <span class="kw">reportFormulaSpectra</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
          <span class="kw">compounds</span> <span class="kw">=</span> <span class="no">compounds</span>, <span class="kw">compoundsNormalizeScores</span> <span class="kw">=</span> <span class="st">"max"</span>,
          <span class="kw">components</span> <span class="kw">=</span> <span class="no">components</span>, <span class="kw">MSPeakLists</span> <span class="kw">=</span> <span class="no">mslists</span>)

<span class="fu"><a href="../reference/reporting.html">reportHTML</a></span>(<span class="no">fGroups</span>, <span class="kw">path</span> <span class="kw">=</span> <span class="st">"report"</span>, <span class="kw">reportPlots</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"chord"</span>, <span class="st">"venn"</span>, <span class="st">"upset"</span>, <span class="st">"eics"</span>, <span class="st">"formulas"</span>), <span class="kw">formulas</span> <span class="kw">=</span> <span class="no">formulas</span>,
           <span class="kw">compounds</span> <span class="kw">=</span> <span class="no">compounds</span>, <span class="kw">compoundsNormalizeScores</span> <span class="kw">=</span> <span class="st">"max"</span>,
           <span class="kw">components</span> <span class="kw">=</span> <span class="no">components</span>, <span class="kw">MSPeakLists</span> <span class="kw">=</span> <span class="no">mslists</span>,
           <span class="kw">selfContained</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">openReport</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<!-- UNDONE: next steps section -->
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Rick Helmus.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
